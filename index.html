<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mythic Realm - Login</title>
    <!-- Use "styles.css" to match your file -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container animated-background">
        <div class="form-box" id="auth-box">
            
            <h1 id="auth-title">Login</h1>
            <p>Welcome, adventurer. Your journey begins here.</p>
            
            <form id="auth-form">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Password" required>
                <!-- "Confirm Password" field, hidden by default -->
                <input type="password" id="confirm-password" placeholder="Confirm Password" style="display: none;">
                
                <button type="submit" class="btn" id="auth-button">Login</button>
            </form>
            
            <p id="toggle-text">Don't have an account? <a href="#" id="toggle-link">Create one</a></p>
            
            <p>... or ...</p>
            
            <button id="google-signin" class="btn btn-google">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google G Logo" width="20" height="20">
                Sign in with Google
            </button>
            
            <p id="auth-error" class="error-message"></p>
        </div>
    </div>
    
    <!-- 
      JavaScript for Firebase Authentication
    -->
    <script type="module">
        // Import functions from the Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword,
            GoogleAuthProvider,
            signInWithPopup,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

        // ▼▼▼ YOUR FIREBASE CONFIG ▼▼▼
        const firebaseConfig = {
          apiKey: "AIzaSyBws0s5YOGs4na5sGZCL9CEgmhuU_YiH2M",
          authDomain: "mythic-realm-game.firebaseapp.com",
          projectId: "mythic-realm-game",
          storageBucket: "mythic-realm-game.firebasestorage.app",
          messagingSenderId: "936485093407",
          appId: "1:936485093407:web:ccd92c30a17152e21d152a"
        };
        // ▲▲▲ YOUR FIREBASE CONFIG ▲▲▲

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- THIS IS THE FIX FOR THE URL ERROR ---
        const baseURL = "https://deepmobb.github.io/gameiss/";

        // Get elements
        const authForm = document.getElementById('auth-form');
        const googleBtn = document.getElementById('google-signin');
        const authError = document.getElementById('auth-error');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        
        const authTitle = document.getElementById('auth-title');
        const authButton = document.getElementById('auth-button');
        const toggleText = document.getElementById('toggle-text');
        const toggleLink = document.getElementById('toggle-link');

        let isLoginMode = true;

        // Toggle between Login and Sign-up
        toggleLink.addEventListener('click', (e) => {
            e.preventDefault();
            isLoginMode = !isLoginMode;
            
            if (isLoginMode) {
                // Switch to Login
                authTitle.textContent = 'Login';
                authButton.textContent = 'Login';
                confirmPasswordInput.style.display = 'none';
                toggleText.innerHTML = 'Don\'t have an account? <a href="#" id="toggle-link">Create one</a>';
            } else {
                // Switch to Sign-up
                authTitle.textContent = 'Create Account';
                authButton.textContent = 'Create Account';
                confirmPasswordInput.style.display = 'block';
                confirmPasswordInput.required = true;
                toggleText.innerHTML = 'Already have an account? <a href="#" id="toggle-link">Login</a>';
            }
            // Re-add the event listener to the new link
            document.getElementById('toggle-link').addEventListener('click', arguments.callee);
        });

        // Check if user is already logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, redirect to main menu
                // FIXED: Used the full, absolute URL
                window.location.href = baseURL + 'main.html';
            }
        });

        // Handle Form Submit (Login or Sign-up)
        authForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;

            if (isLoginMode) {
                // --- Login ---
                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        // Signed in, redirect (onAuthStateChanged will handle it)
                    })
                    .catch((error) => {
                        authError.textContent = error.message;
                    });
            } else {
                // --- Sign-up ---
                const confirmPassword = confirmPasswordInput.value;
                if (password !== confirmPassword) {
                    authError.textContent = "Passwords do not match";
                    return;
                }
                
                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        // Signed in, redirect (onAuthStateChanged will handle it)
                    })
                    .catch((error) => {
                        authError.textContent = error.message;
                    });
            }
        });

        // Google Sign-in
        googleBtn.addEventListener('click', () => {
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider)
                .then((result) => {
                    // Signed in, redirect (onAuthStateChanged will handle it)
                })
                .catch((error) => {
                    authError.textContent = error.message;
                });
        });
    </script>
</body>
</html>


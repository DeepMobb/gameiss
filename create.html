<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Character - Mythic Realm</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="form-box creation-form">
            <h1>Create Your Hero</h1>
            
            <!-- NEW: Character Preview Area -->
            <div class="char-preview-container">
                <div id="char-preview" class="char-preview">
                    <!-- These are the same as game.html -->
                    <div id="char-eyes"></div>
                    <div id="char-wings"></div>
                    <div id="char-trail"></div>
                </div>
                <p id="preview-text">Select a race to preview your hero</p>
            </div>
            <hr>

            <form id="character-create-form">
                
                <!-- Character Name -->
                <label for="char-name">Character Name:</label>
                <input type="text" id="char-name" placeholder="Max 8 letters, no numbers" 
                       maxlength="8" pattern="[A-Za-z]{1,8}" 
                       title="Max 8 letters, no numbers or special characters." required>
                <hr>

                <!-- Gender Selection -->
                <label>Gender:</label>
                <div class="radio-group">
                    <input type="radio" id="gender-male" name="gender" value="male" required>
                    <label for="gender-male">Male</label>
                    <input type="radio" id="gender-female" name="gender" value="female" required>
                    <label for="gender-female">Female</label>
                </div>
                <hr>

                <!-- Mythical Race Selection -->
                <label>Mythical Race:</label>
                <div class="radio-group race-selection">
                    <!-- 1. Short and Slim -->
                    <input type="radio" id="race-sprite" name="race" value="Glimmer-sprite" required>
                    <label for="race-sprite" class="race-label">
                        <div class="race-preview sprite"></div>
                        <strong>Glimmer-sprite</strong>
                        <p>Short, slim, and uncannily fast. Fey tricksters of the hidden world.</p>
                    </label>
                    
                    <!-- 2. Big with Wings -->
                    <input type="radio" id="race-skystrider" name="race" value="Skystrider" required>
                    <label for="race-skystrider" class="race-label">
                        <div class="race-preview skystrider"></div>
                        <strong>Skystrider</strong>
                        <p>A massive, winged race, bound to the mountaintops and the open sky.</p>
                    </label>
                    
                    <!-- 3. Part Ghost -->
                    <input type="radio" id="race-wisp" name="race" value="Aura-wisp" required>
                    <label for="race-wisp" class="race-label">
                        <div class="race-preview wisp"></div>
                        <strong>Aura-wisp</strong>
                        <p>Half-material, half-spirit. A spectral being that walks between worlds.</p>
                    </label>
                </div>
                <hr>

                <!-- Physical Modifications -->
                <label>Physical Modifications:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="mod-eyes" name="mod" value="glowing-eyes">
                    <label for="mod-eyes">Glowing Eyes</label>
                    
                    <input type="checkbox" id="mod-trail" name="mod" value="spectral-trail">
                    <label for="mod-trail">Spectral Trail</label>
                    
                    <input type="checkbox" id="mod-wings" name="mod" value="larger-wings">
                    <label for="mod-wings">Larger Wings</label>
                </div>
                <hr>
                
                <button type="submit" class="btn btn-large">Forge Character</button>
            </form>
        </div>
    </div>
    
    <!-- 
      JavaScript for saving character data to Firestore
    -->
    <script type="module">
        // Import functions from the Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // ▼▼▼ YOUR FIREBASE CONFIG ▼▼▼
        const firebaseConfig = {
          apiKey: "AIzaSyBws0s5YOGs4na5sGZCL9CEgmhuU_YiH2M",
          authDomain: "mythic-realm-game.firebaseapp.com",
          projectId: "mythic-realm-game",
          storageBucket: "mythic-realm-game.firebasestorage.app",
          messagingSenderId: "936485093407",
          appId: "1:936485093407:web:ccd92c30a17152e21d152a"
        };
        // ▲▲▲ YOUR FIREBASE CONFIG ▲▲▲

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Get elements
        const createForm = document.getElementById('character-create-form');
        const baseURL = "https://deepmobb.github.io/gameiss/";
        let currentUserId = null; // Variable to store the user's ID

        // --- NEW: Preview Elements ---
        const previewBox = document.getElementById('char-preview');
        const previewText = document.getElementById('preview-text');
        const raceRadios = document.querySelectorAll('input[name="race"]');

        // Check if user is logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                currentUserId = user.uid;
            } else {
                // User is signed out, redirect to login
                window.location.href = baseURL + 'index.html';
            }
        });

        // --- NEW: Event listener for race selection ---
        raceRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                // Get the value (e.g., "Glimmer-sprite") and clean it for the class
                const raceClass = radio.value.toLowerCase(); // "glimmer-sprite"
                
                // Reset the class list
                previewBox.className = 'char-preview';
                // Add the new class
                previewBox.classList.add(raceClass);
                
                // Update the text
                previewText.textContent = `Previewing: ${radio.value}`;
            });
        });

        // Listen for form submission
        createForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Stop the form from reloading the page
            
            if (!currentUserId) {
                alert("Error: No user logged in.");
                return;
            }

            // Get all form data
            const charName = document.getElementById('char-name').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const race = document.querySelector('input[name="race"]:checked').value;
            
            // Get all checked modifications
            const mods = [];
            document.querySelectorAll('input[name="mod"]:checked').forEach((checkbox) => {
                mods.push(checkbox.value);
            });

            // Create a data object
            const characterData = {
                name: charName,
                gender: gender,
                race: race,
                modifications: mods,
                level: 1, // Start every new character at level 1
                createdAt: new Date() // Timestamp
            };

            try {
                // Save the data to Firestore
                // We use the user's ID (currentUserId) as the document ID
                // This links the character directly to the user
                await setDoc(doc(db, "characters", currentUserId), characterData);
                
                // Success! Redirect to the main menu
                // Using alert() temporarily as custom modals aren't built
                alert("Character created!"); 
                window.location.href = baseURL + 'main.html';

            } catch (error) {
                console.error("Error writing document: ", error);
                alert("Could not create character. Please try again.");
            }
        });
    </script>
</body>
</html>


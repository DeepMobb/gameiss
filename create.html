<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Character - Mythic Realm</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- "creation-form" now wraps both columns -->
        <div class="form-box creation-form">

            <!-- COLUMN 1: The Form -->
            <div class="form-column">
                <h1>Create Your Hero</h1>

                <form id="character-create-form">
                    
                    <!-- Character Name -->
                    <label for="char-name">Character Name:</label>
                    <input type="text" id="char-name" placeholder="Max 8 letters, no numbers" 
                           maxlength="8" pattern="[A-Za-z]{1,8}" 
                           title="Max 8 letters, no numbers or special characters." required>
                    <hr>

                    <!-- Gender Selection -->
                    <label>Gender:</label>
                    <div class="radio-group">
                        <input type="radio" id="gender-male" name="gender" value="male" required>
                        <label for="gender-male">Male</label>
                        <input type="radio" id="gender-female" name="gender" value="female" required>
                        <label for="gender-female">Female</label>
                    </div>
                    <hr>

                    <!-- Mythical Race Selection -->
                    <label>Mythical Race:</label>
                    <div class="radio-group race-selection">
                        <!-- 1. Short and Slim -->
                        <input type="radio" id="race-sprite" name="race" value="Glimmer-sprite" required>
                        <label for="race-sprite" class="race-label">
                            <div class="race-preview sprite"></div>
                            <strong>Glimmer-sprite</strong>
                            <p>Short, slim, and uncannily fast. Fey tricksters of the hidden world.</p>
                        </label>
                        
                        <!-- 2. Big with Wings -->
                        <input type="radio" id="race-skystrider" name="race" value="Skystrider" required>
                        <label for="race-skystrider" class="race-label">
                            <div class="race-preview skystrider"></div>
                            <strong>Skystrider</strong>
                            <p>A massive, winged race, bound to the mountaintops and the open sky.</p>
                        </label>
                        
                        <!-- 3. Part Ghost -->
                        <input type="radio" id="race-wisp" name="race" value="Aura-wisp" required>
                        <label for="race-wisp" class="race-label">
                            <div class="race-preview wisp"></div>
                            <strong>Aura-wisp</strong>
                            <p>Half-material, half-spirit. A spectral being that walks between worlds.</p>
                        </label>
                    </div>
                    <hr>

                    <!-- Physical Modifications -->
                    <label>Physical Modifications:</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="mod-eyes" name="mod" value="glowing-eyes">
                        <label for="mod-eyes">Glowing Eyes</label>
                        
                        <input type="checkbox" id="mod-trail" name="mod" value="spectral-trail">
                        <label for="mod-trail">Spectral Trail</label>
                        
                        <input type="checkbox" id="mod-wings" name="mod" value="larger-wings">
                        <label for="mod-wings">Larger Wings (Skystriders only)</label>
                    </div>
                    <hr>
                    
                    <button type="submit" class="btn btn-large">Forge Character</button>
                </form>
            </div>

            <!-- COLUMN 2: The Preview -->
            <div class="preview-column">
                <div class="char-preview-container">
                    <p id="preview-text">Select a race and gender</p>
                    
                    <!-- REVERTED to CSS Block Character -->
                    <div id="char-preview" class="char-preview">
                        <div class="char-head">
                            <div id="char-eyes" class="char-eyes"></div>
                        </div>
                        <div class="char-torso">
                            <div id="char-wings" class="char-wings"></div>
                        </div>
                        <div class="char-legs"></div>
                        <div id="char-trail" class="char-trail"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <!-- 
      JavaScript for saving character data to Firestore
    -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // ▼▼▼ YOUR FIREBASE CONFIG ▼▼▼
        const firebaseConfig = {
          apiKey: "AIzaSyBws0s5YOGs4na5sGZCL9CEgmhuU_YiH2M",
          authDomain: "mythic-realm-game.firebaseapp.com",
          projectId: "mythic-realm-game",
          storageBucket: "mythic-realm-game.firebasestorage.app",
          messagingSenderId: "936485093407",
          appId: "1:936485093407:web:ccd92c30a17152e21d152a"
        };
        // ▲▲▲ YOUR FIREBASE CONFIG ▲▲▲

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Get elements
        const createForm = document.getElementById('character-create-form');
        const baseURL = "https://deepmobb.github.io/gameiss/";
        let currentUserId = null;

        // --- CSS Preview Elements ---
        const previewBox = document.getElementById('char-preview');
        const previewText = document.getElementById('preview-text');
        const raceRadios = document.querySelectorAll('input[name="race"]');
        const genderRadios = document.querySelectorAll('input[name="gender"]'); // NEW
        
        // Modification Checkboxes
        const modEyes = document.getElementById('mod-eyes');
        const modTrail = document.getElementById('mod-trail');
        const modWings = document.getElementById('mod-wings');

        // Character Parts
        const charEyes = document.getElementById('char-eyes');
        const charTrail = document.getElementById('char-trail');
        const charWings = document.getElementById('char-wings');

        let selectedRace = "";
        let selectedGender = "";

        // Check if user is logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUserId = user.uid;
            } else {
                window.location.href = baseURL + 'index.html';
            }
        });
        
        function updatePreview() {
            // Reset classes
            previewBox.className = 'char-preview';
            
            if (selectedRace) {
                const raceClass = selectedRace.toLowerCase().replace('-', ''); // "glimmersprite"
                previewBox.classList.add(raceClass);
            }
            if (selectedGender) {
                previewBox.classList.add(selectedGender.toLowerCase()); // "male" or "female"
            }
            
            // Update text
            if (selectedRace && selectedGender) {
                previewText.textContent = `Previewing: ${selectedGender} ${selectedRace}`;
            } else {
                previewText.textContent = "Select a race and gender";
            }
            
            // Update mods
            charEyes.style.display = modEyes.checked ? 'block' : 'none';
            charTrail.style.display = modTrail.checked ? 'block' : 'none';
            
            charWings.style.display = 'none'; // Hide by default
            if (selectedRace === 'Skystrider') {
                charWings.style.display = 'block';
                charWings.style.transform = modWings.checked ? 'scale(1.5)' : 'scale(1)';
            }
        }

        // Event listener for race selection
        raceRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                selectedRace = radio.value;
                updatePreview();
            });
        });
        
        // NEW: Event listener for gender selection
        genderRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                selectedGender = radio.value;
                updatePreview();
            });
        });

        // Event listeners for modifications
        modEyes.addEventListener('change', updatePreview);
        modTrail.addEventListener('change', updatePreview);
        modWings.addEventListener('change', updatePreview);


        // Listen for form submission
        createForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUserId) {
                alert("Error: No user logged in.");
                return;
            }

            // Get all form data
            const charName = document.getElementById('char-name').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const race = document.querySelector('input[name="race"]:checked').value;
            
            const mods = [];
            document.querySelectorAll('input[name="mod"]:checked').forEach((checkbox) => {
                mods.push(checkbox.value);
            });

            const characterData = {
                name: charName,
                gender: gender,
                race: race,
                modifications: mods,
                level: 1,
                createdAt: new Date(),
                // REMOVED imageUrl
                gold: 100,
                inventory: []
            };

            try {
                // Save the data to Firestore
                await setDoc(doc(db, "characters", currentUserId), characterData);
                
                alert("Character created!"); 
                window.location.href = baseURL + 'main.html';

            } catch (error) {
                console.error("Error writing document: ", error);
                alert("Could not create character. Please try again.");
            }
        });
    </script>
</body>
</html>

